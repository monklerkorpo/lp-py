<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–†–µ—à–∞—Ç–µ–ª—å –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –ó–∞–¥–∞—á</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="max-w-4xl w-full bg-white rounded-2xl shadow-xl p-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-8 text-center">–†–µ—à–∞—Ç–µ–ª—å –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –ó–∞–¥–∞—á</h1>

    <!-- Template Selection -->
    <div class="mb-8">
      <label class="block text-lg font-medium text-gray-700 mb-3">–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω –∑–∞–¥–∞—á–∏</label>
      <select id="template" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω</option>
        <option value="production">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞</option>
        <option value="transport">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞</option>
      </select>
    </div>

    <!-- Optimization Goal -->
    <div class="mb-8">
      <label class="block text-lg font-medium text-gray-700 mb-3">–¶–µ–ª—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</label>
      <div id="objective-inputs" class="flex flex-wrap gap-3 items-center p-4 bg-gray-50 rounded-lg"></div>
      <div class="mt-3 flex gap-3">
        <input id="num-variables" type="number" min="1" max="10" value="2" class="w-24 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="–ö–æ–ª-–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤" />
        <button id="update-objective" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">–û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>
    </div>

    <!-- Optimization Type -->
    <div class="mb-8">
      <label class="block text-lg font-medium text-gray-700 mb-3">–¶–µ–ª—å</label>
      <select id="optimize_type" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <option value="max">–ú–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–∏–±—ã–ª–∏</option>
        <option value="min">–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –∑–∞—Ç—Ä–∞—Ç</option>
      </select>
    </div>

    <div class="mb-8">
      <label class="block text-lg font-medium text-gray-700 mb-3">–ú–µ—Ç–æ–¥ —Ä–µ—à–µ–Ω–∏—è</label>
      <select id="method" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <option value="simplex" selected>–°–∏–º–ø–ª–µ–∫—Å</option>
        <option value="artificial">–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –±–∞–∑–∏—Å</option>
      </select>
    </div>

    <!-- Resource Constraints -->
    <div class="mb-8">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤</h2>
      <div id="constraints" class="space-y-4"></div>
      <button id="add-constraint" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
        –î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
      </button>
    </div>

    <!-- Error Messages -->
    <div id="error-messages" class="mb-4 hidden bg-red-50 p-4 rounded-lg text-red-600"></div>

    <!-- Solve Button -->
    <button id="solve-btn" class="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2 text-lg font-medium">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
      –†–µ—à–∏—Ç—å
    </button>

    <!-- Output -->
    <div class="mt-8">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">üìÑ –†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
      <div id="output" class="bg-gray-50 p-6 rounded-lg text-gray-700"></div>
    </div>
  </div>
  <script>
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
const state = {
    numVariables: 2,
    lastResult: null,
  };
  
  // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
  const elements = {
    template: document.getElementById('template'),
    objectiveInputs: document.getElementById('objective-inputs'),
    numVariables: document.getElementById('num-variables'),
    updateObjective: document.getElementById('update-objective'),
    optimizeType: document.getElementById('optimize_type'),
    constraints: document.getElementById('constraints'),
    addConstraint: document.getElementById('add-constraint'),
    errorMessages: document.getElementById('error-messages'),
    solveBtn: document.getElementById('solve-btn'),
    output: document.getElementById('output'),
  };
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
  function updateObjectiveInputs() {
    state.numVariables = parseInt(elements.numVariables.value) || 2;
    if (state.numVariables < 1 || state.numVariables > 10) {
      showErrors(['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 10']);
      elements.numVariables.classList.add('invalid');
      return;
    }
    elements.numVariables.classList.remove('invalid');
  
    elements.objectiveInputs.innerHTML = '';
    for (let i = 0; i < state.numVariables; i++) {
      const wrapper = document.createElement('div');
      wrapper.className = 'flex items-center gap-2';
      wrapper.innerHTML = `
        <input type="text" class="w-32 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="–ü—Ä–æ–¥—É–∫—Ç ${i+1}" data-index="${i}">
        <input type="number" step="any" class="w-20 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="–ö–æ—ç—Ñ—Ñ.">
      `;
      elements.objectiveInputs.appendChild(wrapper);
      if (i < state.numVariables - 1) {
        elements.objectiveInputs.appendChild(document.createTextNode(' + '));
      }
    }
    updateConstraints();
  }
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
  function updateConstraints() {
    elements.constraints.innerHTML = '';
    addConstraint();
  }
  
  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
  function addConstraint() {
    const div = document.createElement('div');
    div.className = 'constraint bg-gray-50 p-4 rounded-lg flex flex-wrap items-center gap-3 fade-in';
  
    for (let i = 0; i < state.numVariables; i++) {
      const wrapper = document.createElement('div');
      wrapper.className = 'flex items-center gap-2';
      wrapper.innerHTML = `
        <input type="number" step="any" class="w-20 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 coeff" placeholder="x${i+1}">
        ${i < state.numVariables - 1 ? ' + ' : ''}
      `;
      div.appendChild(wrapper);
    }
  
    div.innerHTML += `
      <select class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 type">
        <option value="<="><=</option>
        <option value=">=">>=</option>
        <option value="=">=</option>
      </select>
      <div class="flex items-center gap-2">
        <input type="number" step="any" class="w-24 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rhs" placeholder="–õ–∏–º–∏—Ç">
        <input type="text" class="w-24 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="–ï–¥. –∏–∑–º.">
      </div>
      <input type="text" class="w-32 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞">
      <button type="button" class="px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    `;
    div.querySelector('button').onclick = () => div.remove();
    elements.constraints.appendChild(div);
  }
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤
  function loadTemplate() {
    const template = elements.template.value;
    if (template === 'production') {
      elements.numVariables.value = 2;
      updateObjectiveInputs();
      const inputs = elements.objectiveInputs.querySelectorAll('input[type="text"]');
      inputs[0].value = '–ü—Ä–æ–¥—É–∫—Ç A';
      inputs[1].value = '–ü—Ä–æ–¥—É–∫—Ç B';
      elements.objectiveInputs.querySelectorAll('input[type="number"]')[0].value = 50;
      elements.objectiveInputs.querySelectorAll('input[type="number"]')[1].value = 60;
      elements.optimizeType.value = 'max';
      elements.constraints.innerHTML = '';
      addConstraint();
      const c1 = elements.constraints.querySelector('.constraint');
      c1.querySelectorAll('.coeff')[0].value = 2;
      c1.querySelectorAll('.coeff')[1].value = 3;
      c1.querySelector('.type').value = '<=';
      c1.querySelector('.rhs').value = 100;
      c1.querySelector('input[placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞"]').value = '–°—ã—Ä—å—ë';
      c1.querySelector('input[placeholder="–ï–¥. –∏–∑–º."]').value = '–∫–≥';
      addConstraint();
      const c2 = elements.constraints.querySelectorAll('.constraint')[1];
      c2.querySelectorAll('.coeff')[0].value = 1;
      c2.querySelectorAll('.coeff')[1].value = 1;
      c2.querySelector('.type').value = '<=';
      c2.querySelector('.rhs').value = 40;
      c2.querySelector('input[placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞"]').value = '–†–∞–±–æ—á–∏–µ —á–∞—Å—ã';
      c2.querySelector('input[placeholder="–ï–¥. –∏–∑–º."]').value = '—á–∞—Å—ã';
    } else if (template === 'transport') {
      elements.numVariables.value = 2;
      updateObjectiveInputs();
      const inputs = elements.objectiveInputs.querySelectorAll('input[type="text"]');
      inputs[0].value = '–ú–∞—Ä—à—Ä—É—Ç 1';
      inputs[1].value = '–ú–∞—Ä—à—Ä—É—Ç 2';
      elements.objectiveInputs.querySelectorAll('input[type="number"]')[0].value = 5;
      elements.objectiveInputs.querySelectorAll('input[type="number"]')[1].value = 7;
      elements.optimizeType.value = 'min';
      elements.constraints.innerHTML = '';
      addConstraint();
      const c1 = elements.constraints.querySelector('.constraint');
      c1.querySelectorAll('.coeff')[0].value = 1;
      c1.querySelectorAll('.coeff')[1].value = 1;
      c1.querySelector('.type').value = '=';
      c1.querySelector('.rhs').value = 100;
      c1.querySelector('input[placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞"]').value = '–û–±—ä—ë–º –≥—Ä—É–∑–∞';
      c1.querySelector('input[placeholder="–ï–¥. –∏–∑–º."]').value = '—Ç–æ–Ω–Ω—ã';
    }
  }
  
  // –ü–æ–∫–∞–∑ –æ—à–∏–±–æ–∫
  function showErrors(errors) {
    elements.errorMessages.innerHTML = `
      <div class="flex items-center gap-2">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <ul class="list-disc pl-5">
          ${errors.map(error => `<li>${error}</li>`).join('')}
        </ul>
      </div>
    `;
    elements.errorMessages.classList.remove('hidden');
  }
  
  // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫
  function clearErrors() {
    elements.errorMessages.innerHTML = '';
    elements.errorMessages.classList.add('hidden');
    document.querySelectorAll('.invalid').forEach(el => el.classList.remove('invalid'));
  }
  
  // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  function validateInputs() {
    const errors = [];
    const objectiveInputs = elements.objectiveInputs.querySelectorAll('input[type="number"]');
    const constraintElems = elements.constraints.querySelectorAll('.constraint');
  
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
    const objective = Array.from(objectiveInputs).map(input => input.value);
    objectiveInputs.forEach(input => input.classList.remove('invalid'));
    if (objective.length === 0) {
      errors.push('–¶–µ–ª—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–æ–¥—É–∫—Ç');
    } else {
      objective.forEach((val, i) => {
        if (val === '' || isNaN(parseFloat(val))) {
          errors.push(`–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è ${elements.objectiveInputs.querySelectorAll('input[type="text"]')[i].value || `x${i+1}`} –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º`);
          objectiveInputs[i].classList.add('invalid');
        }
      });
    }
  
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
    if (constraintElems.length === 0) {
      errors.push('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ');
    }
    constraintElems.forEach((elem, idx) => {
      const coeffInputs = elem.querySelectorAll('.coeff');
      const coefficients = Array.from(coeffInputs).map(input => input.value);
      const type = elem.querySelector('.type').value;
      const rhs = elem.querySelector('.rhs').value;
      const resourceName = elem.querySelector('input[placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞"]').value || `–†–µ—Å—É—Ä—Å ${idx+1}`;
  
      coeffInputs.forEach(input => input.classList.remove('invalid'));
      elem.querySelector('.rhs').classList.remove('invalid');
  
      if (coefficients.length !== state.numVariables) {
        errors.push(`–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ "${resourceName}": –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ (${coefficients.length}) –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (${state.numVariables})`);
      }
      coefficients.forEach((val, i) => {
        if (val === '' || isNaN(parseFloat(val))) {
          errors.push(`–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ "${resourceName}": –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç x${i+1} –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º`);
          coeffInputs[i].classList.add('invalid');
        }
      });
      if (rhs === '' || isNaN(parseFloat(rhs))) {
        errors.push(`–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ "${resourceName}": –ª–∏–º–∏—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º`);
        elem.querySelector('.rhs').classList.add('invalid');
      } else if (parseFloat(rhs) < 0) {
        errors.push(`–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ "${resourceName}": –ª–∏–º–∏—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º`);
        elem.querySelector('.rhs').classList.add('invalid');
      }
    });
  
    return errors;
  }
  
  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  function formatResult(result) {
    const optimizeType = elements.optimizeType.value;
    const objectiveNames = Array.from(elements.objectiveInputs.querySelectorAll('input[type="text"]')).map(input => input.value || `x${parseInt(input.dataset.index)+1}`);
    const statusText = result.status === 'optimal' ? '–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ' : '–†–µ—à–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
    const objectiveText = optimizeType === 'max' ? '–ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–∏–±—ã–ª—å' : '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã';
  
    let output = `
      <div class="space-y-6">
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <h3 class="text-lg font-semibold text-gray-800 mb-2">–°—Ç–∞—Ç—É—Å</h3>
          <p class="text-gray-600">${statusText}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <h3 class="text-lg font-semibold text-gray-800 mb-2">${objectiveText}</h3>
          <p class="text-2xl font-bold text-blue-600">${result.objective_value.toFixed(2)}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            ${Object.entries(result.solution).map(([key, value], idx) => `
              <div class="flex items-center justify-between">
                <span class="text-gray-600 font-medium">${objectiveNames[idx] || key}:</span>
                <span class="text-gray-800 font-bold">${value.toFixed(2)}</span>
              </div>
            `).join('')}
          </div>
        </div>
      </div>
    `;
  
    if (result.status === 'optimal') {
      output += `<div class="mt-6"><canvas id="solution-chart"></canvas></div>`;
      setTimeout(() => {
        const ctx = document.getElementById('solution-chart').getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: Object.keys(result.solution).map((_, idx) => objectiveNames[idx] || `x${idx+1}`),
            datasets: [{
              label: optimizeType === 'max' ? '–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ' : '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ',
              data: Object.values(result.solution),
              backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'],
              borderColor: ['#1e3a8a', '#047857', '#b45309', '#991b1b', '#6d28d9'],
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: { beginAtZero: true, title: { display: true, text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ' } },
              x: { title: { display: true, text: optimizeType === 'max' ? '–ü—Ä–æ–¥—É–∫—Ç—ã' : '–ú–∞—Ä—à—Ä—É—Ç—ã' } }
            },
            plugins: { title: { display: true, text: optimizeType === 'max' ? '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–∏' : '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç' } }
          }
        });
      }, 0);
      output += `<button onclick="exportToCSV()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>`;
    }
  
    return output;
  }
  
  // –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
  function exportToCSV() {
    if (!state.lastResult) return;
    const objectiveNames = Array.from(elements.objectiveInputs.querySelectorAll('input[type="text"]')).map(input => input.value || `x${parseInt(input.dataset.index)+1}`);
    const optimizeType = elements.optimizeType.value;
    let csv = '–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è,–ó–Ω–∞—á–µ–Ω–∏–µ\n';
    Object.entries(state.lastResult.solution).forEach(([key, value], idx) => {
      csv += `${objectiveNames[idx] || key},${value.toFixed(2)}\n`;
    });
    csv += `${optimizeType === 'max' ? '–ü—Ä–∏–±—ã–ª—å' : '–ó–∞—Ç—Ä–∞—Ç—ã'},${state.lastResult.objective_value.toFixed(2)}\n`;
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'economic_solution.csv';
    a.click();
    URL.revokeObjectURL(url);
  }
  
  // –†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
  async function solve() {
    clearErrors();
    elements.output.innerHTML = '<div class="flex items-center justify-center gap-2"><svg class="animate-spin h-5 w-5 text-blue-600" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> –ó–∞–≥—Ä—É–∑–∫–∞...</div>';
    elements.solveBtn.disabled = true;
    elements.solveBtn.classList.add('opacity-50', 'cursor-not-allowed');
  
    try {
      const objectiveInputs = elements.objectiveInputs.querySelectorAll('input[type="number"]');
      const objectiveNames = Array.from(elements.objectiveInputs.querySelectorAll('input[type="text"]')).map(input => input.value || `x${parseInt(input.dataset.index)+1}`);
      const objective = Array.from(objectiveInputs).map(input => parseFloat(input.value));
      const constraintElems = elements.constraints.querySelectorAll('.constraint');
      const constraints = Array.from(constraintElems).map(elem => ({
        coefficients: Array.from(elem.querySelectorAll('.coeff')).map(input => parseFloat(input.value)),
        type: elem.querySelector('.type').value,
        rhs: parseFloat(elem.querySelector('.rhs').value),
        resourceName: elem.querySelector('input[placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞"]').value || `–†–µ—Å—É—Ä—Å ${constraintElems.length}`,
        unit: elem.querySelector('input[placeholder="–ï–¥. –∏–∑–º."]').value || '',
      }));
  
      const errors = validateInputs();
      if (errors.length > 0) {
        showErrors(errors);
        elements.output.innerHTML = '';
        return;
      }
  
      const method = constraints.some(c => c.type === '>=' || c.type === '=') ? 'artificial' : 'simplex';
      const payload = {
        objective,
        objectiveNames,
        constraints,
        method,
        optimize_type: elements.optimizeType.value,
      };
  
      const res = await fetch('http://localhost:5000/api/solve', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
  
      if (!res.ok) {
        const errorData = await res.json();
        throw new Error(errorData.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
      }
  
      state.lastResult = await res.json();
      elements.output.innerHTML = formatResult(state.lastResult);
    } catch (err) {
      elements.output.innerHTML = `
        <div class="bg-red-50 p-4 rounded-lg text-red-600 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
          –û—à–∏–±–∫–∞: ${err.message}
        </div>
      `;
    } finally {
      elements.solveBtn.disabled = false;
      elements.solveBtn.classList.remove('opacity-50', 'cursor-not-allowed');
    }
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  elements.updateObjective.onclick = updateObjectiveInputs;
  elements.addConstraint.onclick = addConstraint;
  elements.template.onchange = loadTemplate;
  elements.solveBtn.onclick = solve;
  updateObjectiveInputs();
  </script>
</body>
</html>